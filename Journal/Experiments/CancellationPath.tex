1\section{Cancellation path}
\subsection{Purpose}
The purpose of this experiment is to determine the impulse response of the cancellation path, i.e. the transfer-function between the "source-loudspeaker" and the "error-microphone (ear)".
		
\subsection{AAU number list}
\begin{table}[h]
	\centering
	\ra{1.3}
	\begin{tabular}{ c c c } \toprule
		{Item}	& {Description} 						& {AAU-no}. \\ \bottomrule 
		1	&	B\&K Head And Torso Simulator "Henry" Type 4128	& 08453		\\
		2	&	B\&K Ear Simulator Type 4159			& 08453		\\
		3	&	Sennheiser HD 200	Headphones			& 33379		\\
		4	&	Roland Edirol UA-25EX Audio Capture		& 64696		\\
		5	&	Vision B3565 Computer					& NaN		\\
		6	&	B\&K Microphone Power Supply Type 2804	& 07304		\\
		%5	&	B\&K \textonehalf'' Condenser Microphone Type 4134 & 61447\\
		%6	&	B\&K Sound Calibrator Type 4231			& 78301		\\ 
		7	&	B\&K Sound Intensity Calibrator Type 3541	& 08597	\\ \bottomrule
	\end{tabular}
	\caption{Table over equipment used in test}
	\label{tab:UsedEquipmentListningCP}
\end{table}

\subsubsection{Diagram}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Shematic_CalcellationPath.pdf}
	\caption{Preliminary Schematic of the Setup.}
	\label{Schematic}
\end{figure}

\subsubsection{Settings/Description}
\label{SettingsCacellationPath}

\begin{itemize}
	\item Item 4 (Sound Capture port) "PHONES" is set to maximum volume
	\item Item 4 (Sound Capture port) "SENS(INPUT 1/L)" is set to +0 dB		
	\item Item 5 (Computer) is set to 0 dBFS
\end{itemize}


\subsubsection{Pictures}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{CancellationPath_and_Headphones/FullSetup.jpg}
	\caption{Full setup of experiment (Note that external microphone is not in use in the experiment).}
	\label{FullSetupCancellationPath}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{CancellationPath_and_Headphones/CloseUpFace.jpg}
	\caption{Close up of experiment(Note that external microphone is not in use in the experiment).}
	\label{CloseUpCancellationPath}
\end{figure}

\section{Procedure}
\subsection{Set-up}
\begin{enumerate}
	\item Set instruments to comply with the list in \ref{SettingsCacellationPath}
	\item Control, and if necessary, calibrate item 2 using item 7
	\item Place item 3 onto item 1 ("Henry"'s head and ears)
	\item Insert item 2's connector into input of item 6
	\item Connect item 6 to item 4 and connect item 4 to item 5 via USB
	\item Insert item 3's connector into output of item 4
	\item Connect cable from item 4's output to item 4's input
\end{enumerate}

\subsection{Performing the experiment}
\begin{enumerate}
	\item Open Simulink\textsuperscript{\textregistered} and run file "SimulinnkSystemCancellationPath.xls"
	\item Through Simulink\textsuperscript{\textregistered} play "LogChirp.wav" from item 5 via item 4
	\item Record and save, and name "Mic[i].wav" and Ref[i].wav" from item 4 onto item 5 \footnote{[i] indicates the iteration of the experiment}
	\begin{itemize}
		\item[] Perform this experiment for a total of 5 times
	\end{itemize}
\end{enumerate}


\subsection{Data Extraction}
\begin{enumerate}
	\item Place generated .wav-files in same folder as MATLAB\textsuperscript{\textregistered}-script "CancellationPathScript.m".
	\item Open MATLAB\textsuperscript{\textregistered} and run script "CancellationPathScript.m"
\end{enumerate}
This should yield the resulting frequency response, impulse response and finally the transfer function, along other information about the cancellation-path in this set-up.

\subsection{Analysis}
In MATLAB\textsuperscript{\textregistered} the script performs a series of mathematical operations. In short it loads all generated .wav-files and finds the mean. This mean of all measured signals is used to generate an amplitude plot of both the reference signal (the signal looped back from and to the Sound Capture Card) and the signal from the microphone (item 2).

\begin{figure}[H]
	\centering
	\tikzsetnextfilename{CancellationPathAmplitudePlot}
	\input{figures/CancellationPath_MATLAB_Figures/CancellationOutput.tex}
	%\includegraphics[width=0.65\textwidth]{CancellationPath_MATLAB_Figures/CancellationPathAmplitudePlot.png}
	\caption{Amplitude plot of the cancellation path.}
	\label{AmplitudePlotCancellationPath}
\end{figure}


%\begin{figure}[H]
%	\centering
%	\tikzsetnextfilename{Thisisatest}
%	\input{figures/CancellationPath_MATLAB_Figures/lineplotreducer.tex}
%	\caption{Amplitude plot of the cancellation path.}
%	\label{Thisisatest}
%\end{figure}


From here and on the frequency response of the cancellation path is to be found. This is defined as the FT (Fourier Transform) of the microphones recorded signal and is given by:

\begin{equation}
\label{FrequencyResponseEq}
Y(m) = \frac{X(m_{\mu}) *  H(r_{\mu})}{H(r_{\mu}) *  H(r_{\mu})}
\end{equation}
Where:
\begin{itemize}
	\item $Y(m)$ is the FT of the microphone's recording
	\item $H(m_{\mu})$ and $H(r_{\mu})$ is the FT of the meaning over the microphone and reference recordings respectively
	\item "*" denotes the complex conjugation
\end{itemize}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.65\textwidth]{CancellationPath_MATLAB_Figures/CancellationPathFrequencyResponse.png}
	\caption{Frequency Response plot of the cancellation path (NOT TIKZ).}
	\label{FrequencyResponsePlotCancellationPath}
\end{figure}

When the frequency response is known, finding the impulse response of the system is matter of taking the IFT (Inverse Fourier Transform) of the signal.
The signal looks as such:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.65\textwidth]{CancellationPath_MATLAB_Figures/CancellationPathImpulseResponse.png}
	\caption{Impulse Response plot of the cancellation path (NOT TIKZ).}
	\label{CancellationPathImpulseResponse}
\end{figure}

\subsection{Error Sources}
\begin{itemize}
	\item Placement of the actuators and test-devices
	\item Instrument inaccuracies 
	\item Movement of instruments
	\item Low-frequency background noise
\end{itemize}

\subsection{Conclusion}
We done did it