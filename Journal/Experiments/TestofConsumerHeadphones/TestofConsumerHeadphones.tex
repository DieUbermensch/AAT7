
\section{Test of Consumer Headphones}
\subsection{Purpose}
The purpose of this section is to determine the attenuation of the ANC on existing consumer headphones, that are available today, for stochastic speech signals.
Note that this is indeed inly testing the active part, and not the passive damping made by the cuff.


\subsection{AAU number list}
\begin{table}[H]
	\centering
	\ra{1.3}
	\begin{tabular}{ c c c } \toprule
	{Item}	&	{Description} 								& {AAU-no}. \\ 
								\bottomrule 
		1	&	B\&K Head And Torso Simulator "Henry" Type 4128	& 08453	\\
		2	&	B\&K Ear Simulator Type 4159				& 08453		\\
		3	&	Soundcard RME Fireface 802					& 86838		\\
		4	&	Computer running simulink					& NaN		\\
		5	&	B\&K Sound Calibrator Type 4230				& 08155		\\ 
		6	&	Genelec speaker								& 33990		\\ 
		7	& 	B\&K Microphone Power Supply Type 2804		& 07304		\\
		8	&	DSP Freedom Board Rev. 1 					& NaN		\\
								\bottomrule
							& Tested Headphones 			& 			\\
								\bottomrule
		8	& Denon AH GC20 								& NaN 		\\
		8	& Bose QuietComfort 15 							& NaN 		\\
		8	& Bose QuietComfort 25						 	& NaN		\\
		8	& B\&O BEOPLAY H8 								& NaN		\\
								\bottomrule
	\end{tabular}
	\caption{Table over equipment used in test.}
	\label{tab:UsedEquipmentListConsumerHP}
\end{table}

\subsection{Diagram}
\begin{figure}[H]
	\centering
	%\tikzsetnextfilename{OtherBrands}
	\includegraphics[width=0.8\textwidth]{../Journal/Experiments/TestofConsumerHeadphones/OtherBrandsDiagram.pdf}
	\caption{Diagram of the test set-up.}
	\label{OtherBrandsDiagram}
\end{figure}

\subsection{Settings/Description}
\subsubsection{Control and calibration}
\begin{itemize}
	\item Item 6  is placed 1.6 meters from the Item 1.
	\item Item 2 calibrations are made on the computer using Simulink\textsuperscript{\textregistered}.
	\begin{itemize} 
		\item Calibration is made @ 1 $k$Hz using Item 5 with adapter for Item 2. This should yield a signal of 95.6 dB. The measured intensity in MATLAB\textsuperscript{\textregistered} however was 78.12 so all measurements are multiplied by 7.48 to get a calibrated signal in Matlab\textsuperscript{\textregistered}.
	\end{itemize}
\end{itemize}

\subsubsection{Equipment settings}
\begin{itemize}
	\item This experiment is performed with a sampling rate, $F_{s}$ = 48 $k$Hz. 
	\item For Item 5 take care to turn on the "inst"-option in the mixing console. The following gain settings are present: 		
	\begin{itemize}
		\item Line level gain is 0 dB
		\item Error Microphones has gain +30 dB
		\item Ref Microphones has gain +48 dB
		\item Speaker Microphones has gain +48 dB
	\end{itemize}
	\item All settings on the computer is set to 0 dBFS
\end{itemize}
	
	
\subsection{Pictures}
\begin{figure}[H]
	\centering
	\begin{subfigure}[b]{0.5\textwidth}
		\centering
		\includegraphics[width=\textwidth]{../Journal/Experiments/TestofConsumerHeadphones/Pictures/OtherBrandsSetupBack.jpg}
		\caption{Set-up from the back.}
	\end{subfigure}\qquad
	\begin{subfigure}[b]{0.4\textwidth}
		\includegraphics[width=\textwidth]{../Journal/Experiments/TestofConsumerHeadphones/Pictures/OtherBrandsSetupAngle.jpg}
		\caption{Set-up form an angle.}
		\vspace{2ex}
		\includegraphics[width=\textwidth]{../Journal/Experiments/TestofConsumerHeadphones/Pictures/OtherBrandsSetupSide.jpg}
		\caption{Set-up form the side.}
	\end{subfigure}
	\caption{The test set-up form different angles with the Bose QuietComfort 25 headphone.}
\label{fig:OtherBrandsPicture}
\end{figure}


\subsection{Procedure}
	\subsubsection{Set-up}
	\begin{enumerate}
		\item Connect cable from Item 3's "Out 1L" to Item 6's "Line in"
		\item Connect cable from Item 3's "Out 1R" to Item 3's "In 1L"
		\item Connect cable from Item 2 to Item 7's "Input"
		\item Connect cable from Item 7's "Output" to Item 3's "IN 2R"
		\item Connect USB-cable from Item 4 to Item 3
	\end{enumerate}

	\subsubsection{Performing Experiment}
	\begin{enumerate}
		\item Open Simulink\textsuperscript{\textregistered} and open and run file \path{OtherBrands.xls}
		\begin{itemize} 
			\item The simulations outputs a speech signal at 0 dBFS over the span of 12 seconds
			\begin{itemize}
				\item [] The signal constructed using speech-files from "The Archimedes Project" by Bang \& Olufsen. \\
				The signal is composed of three seconds of the UK male anechoic sample followed by three seconds of silence, followed by the UK female anechoic sample, and ends with another three seconds of silence.
			\end{itemize}
			\item The simulation runs for 14 seconds
		\end{itemize}
		\item Rename generated file \path{GeneratedANC} according to headphone tested, and whether or not ANC was enabled. E.g. \path{Denonon[1].wav} for the first test of the Denon AH GC20 headhpone with ANC enabled. Names in \path{evaluatePerformance.m}-script is named accordingly.
				\begin{itemize}
			\item[] Perform this experiment for as many headphones as desired.
		\end{itemize}
	\end{enumerate}
	
		
\subsection{Data Extraction}
\begin{enumerate}
	\item Open MATLAB\textsuperscript{\textregistered} and run script \path{evaluatePerformance.m}
\end{enumerate}

From performing the experiment, a list of files were generated, ten for each device tested; five with ANC enabled and five with ANC disabled.
The difference between the enabled and the disabled is plotted on the graph below, for each device tested. The list can be seen below

\begin{itemize}
	\item \path{Denonon[i].wav}			(Denon AH GC20 w/ ANC)
	\item \path{Denonoff[i].wav}		(Denon AH GC20 w/o ANC)
	\item \path{BoseQC15on[i].wav}		(Bose QuietComfort 15 w/ ANC)
	\item \path{BoseQC15off[i].wav}		(Bose QuietComfort 15 w/o ANC)
	\item \path{BoseQC25on[i].wav}		(Bose QuietComfort 25 w/ ANC)
	\item \path{BoseQC25off[i].wav}		(Bose QuietComfort 25 w/o ANC)
	\item \path{BOH8on[i].wav}			(B\&O BEOPLAY H8 w/ ANC)
	\item \path{BOH8off[i].wav}			(B\&O BEOPLAY H8 w/o ANC)
	\item \path{Denonon[i].wav}		(Denon AH GC20 w/ ANC)
	\item \path{Denonoff[i].wav}		(Denon AH GC20 w/o ANC)
	\item \path{BoseQC15on[i].waw}		(Bose QuietComfort 15 w/ ANC)
	\item \path{BoseQC15off[i].wav}		(Bose QuietComfort 15 w/o ANC)
	\item \path{BoseQC25on[i].wav}		(Bose QuietComfort 25 w/ ANC)
	\item \path{BoseQC25off[i].wav}		(Bose QuietComfort 25 w/o ANC)
	\item \path{BOH8on[i].wav}			(B\&O BEOPLAY H8 w/ ANC)
	\item \path{BOH8off[i].wav}		(B\&O BEOPLAY H8 w/o ANC)
	\footnote{[i] indicates the iteration of the experiment}
\end{itemize}


\subsection{Analysis}
The five files of each ANC setting for each headphone is then meaned and cross correlated with the opposing ANC-setting of the same headphone, to find the relative difference between the headphones on- and off ANC-setting.\\
This difference is then plotted for all headphones on \autoref{fig:OtherBrandsTestCompare}.
\\
The impulse response of the difference between enabled and disabled recorded signals is to be found.
This is done by finding the frequency response of the "signal", which the cross correlation between e.g. \path{Denonon[i].wav} and \path{Denonon[i].wav} This is done by taking the FT of the cross correlated signals, seen in \autoref{FrequencyResponseEq2}.


\begin{equation}\label{FrequencyResponseEq2}
%H(f) = \frac{Y(m_{\mu}) *  X(r_{\mu})}{X(r_{\mu}) *  X(r_{\mu})}
H(f) = \frac{Y(f) \cdot X\textsuperscript{*}(f)}{X(f) \cdot X\textsuperscript{*}(f)}
\end{equation}
Where:
\begin{itemize}
	%\item " $*$ " denotes the complex conjugation
	\item $H(f)$ is the FT of the "difference between the signals".
	\item $Y(f)$ is the FT of the recorded signals, with ANC enabled,  Denonon[i].
	\item $X(f)$ is the FT of the recorded signals, with ANC disabled, Denonoff[i].
\end{itemize}

In figure \autoref{fig:BOH8Comp}-\autoref{fig:DenonComp} the responses for the tested headphones can be seen. Not that a more smooth fitted curve has been applied, for better comparison between the four tested headphones.

\begin{figure}[H]
	\centering
	\tikzsetnextfilename{BOH8Compare}
	\input{../Journal/Experiments/TestofConsumerHeadphones/Plots/BOH8Compare(fig).tex}
	\caption{B\&O H8 measured in an anechoic chamber and averaged over five measurements (blue), results were filtered using a 1/3 octave filter bank (red).}
	\label{fig:BOH8Comp}
\end{figure}

\begin{figure}[H]	
	\centering
	\tikzsetnextfilename{Bose15Compare}
	\input{../Journal/Experiments/TestofConsumerHeadphones/Plots/Bose15Compare(fig).tex}
	\caption{Bose QuietComfort 15 measured in an anechoic chamber and averaged over five measurements (blue), results were filtered using a 1/3 octave filter bank (red).}
	\label{fig:QC15Comp}
\end{figure}

\begin{figure}[H]
	\centering
	\tikzsetnextfilename{Bose25Compare}
	\input{../Journal/Experiments/TestofConsumerHeadphones/Plots/Bose25Compare(fig).tex}
	\caption{Bose QuietComfort 25 measured in an anechoic chamber and averaged over five measurements (blue), results were filtered using a 1/3 octave filter bank (red).}
	\label{fig:QC25Comp}
\end{figure}

\begin{figure}[H]
	\centering
	\tikzsetnextfilename{DenonCompare}
	\input{../Journal/Experiments/TestofConsumerHeadphones/Plots/DenonCompare(fig).tex}
	\caption{Denon AH GC20 measured in an anechoic chamber and averaged over five measurements (blue), results were filtered using a 1/3 octave filter bank (red).}
	\label{fig:DenonComp}
\end{figure}

In figure \autoref{fig:OtherBrandsTestCompare} the fitted comparison can be seen, this representation provides a better overview of the four-way comparison.

%\begin{figure}[H]
%	\centering
%	\tikzsetnextfilename{ComparedConusmerHPApp}
%	\input{../Journal/Experiments/TestofConsumerHeadphones/Plots/SmoothCompareAppendix(fig).tex}
%	\caption{Comparison of the Denon(blue), Bang \& Olufsen H8(red), Bose QC15(yellow) and Bose QC25(purple) fitted curves.}
%	\label{fig:OtherBrandsTestCompare}
%\end{figure}


\subsection{Conclusion}
The relative difference between a headphones attenuation with and without ANC was found for four different consumer headphones. And the testers concluded that the Bose QuietComfort 25 H8 had the best active part.




