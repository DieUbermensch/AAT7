
\section{The Angle of Incidences' Influence on the Headphone Transfer Function} \label{sec:AngleOfIncidence}

All data from this experiment can be found at
 \path{CD:\\Appendices\Appendix H - The Angles of Incidences Influence on the Headphone Transfer-Function\..}

\subsection{Purpose}
The purpose of this experiment is to determine if the angle of incidence has any influence on the found headphone transfer function. 

The hypothesis is that the angle on incidence will influence both the time delay and magnitude response of the transfer functions. Measurements will only be performed in a horizontal plane. 

\subsection{AAU number list}

Table \ref{tab:AngleOfIncideceHP} list the equipment used during the experiment.

\begin{table}[H]
	\centering
	\ra{1.3}
	\begin{tabular}{ c c c } \toprule
		{Item}	& {Description} 						& {AAU-no}. \\ \bottomrule 
		1	&	B\&K Head And Torso Simulator "Henry" Type 4128	& 08453	\\
		2	&	B\&K Â½'' Condenser Microphone Type 4134 	& 08130		\\
		3	&	Beyerdynamic DT 770 Headphones				& 2037-18		\\
		4	&	Soundcard RME Fireface 802					& 86838		\\
		5	&	HP 6930p laptop									& NaN		\\
		6	&	G.R.A.S. 26-AK Standard preamplifier		& 52665		\\
		7	&	B\&K Sound Calibrator Type 4230				& 08155		\\ 
		8	&	Knowles FG-23329 microphone					& NaN		\\
		9	&	Genelec 1031-A speaker								& 33990		\\ 
		10	&	Preamp for FG-23329  microphone	& NaN\\
		11	& 	B\&K Microphone Power Supply Type 2804		& 07304		\\
		\bottomrule
	\end{tabular}
	\caption{Table over equipment used during the experiment.}
	\label{tab:AngleOfIncideceHP}
\end{table}

\subsubsection{Choice of equipment}
The experiment aims to be valid in the frequency range 50 Hz to 20 $k$Hz. This means that all equipment used should work within the span of this frequency range. \\\\
The experiment uses a total of three microphones:
\begin{itemize}
	\item The error microphone; located inside the HATS's ear is given by the type fitted to the dummy.
	\item The 'SpeakerMic'; it should be as small as possible in order to avoid influencing the transfer functions that are being measured.
	\begin{itemize}
		\item For this a Knowles FG-23329 is used, since that is the smallest readily available.
	\end{itemize}
	\item The Ref microphone; this has less restrictions on size and placement. This allows for the choice of a standard measurement microphone.
	\begin{itemize}
		\item The B\&K 4134 is chosen.
	\end{itemize}
	\item The speaker; the limiting criterion of this is the lower roll of, especially in an anechoic room where no amplification of lower frequencies is present. However transfer functions between the microphones are measured, so absolute flatness is not critical.
	\begin{itemize}
		\item The Genelec 1031-A is chosen, due to its specifications meeting the selected criteria.
	\end{itemize}
	\item The measurement system uses a RME Fireface 802 controlled using Simulink\textsuperscript{\textregistered}. Impulse responses are calculated using the method described in \autoref{Sec:MeasATransFunc}. 
\end{itemize}

\subsection{Diagram}

Figure \ref{fig:AngleOfIndDiagram} shows set-up of the experiment. When rotating the head different angles between the line created by the three microphones and the speaker is obtained. It is possible to determine the angle by measuring the difference in time of arrival between the speaker microphone and reference microphone. This is further described in section \ref{sec:AngleDescription}.

\begin{figure}[H]
	\centering
	\begin{subfigure}[b]{.4\textwidth}
		\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceOnAxis.pdf}
		\caption{On axis.}
		\label{fig:AngOfIndOnax}
		\vspace{2ex}
		\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceOffAxis.pdf}
		\caption{Off axis.}
		\label{fig:AngOfIndOffax}
	\end{subfigure} 
	\begin{subfigure}[b]{.4\textwidth}
	\centering
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceSchematic.pdf}
	\caption{Placement of microphones.}
	\label{fig:AngOgIndMicplace}
\end{subfigure}
	\caption{Placement of microphones and rotation.}
	\label{fig:AngleOfIndDiagram}
\end{figure}


\subsection{Settings/Description}\label{sec:AngleDescription}
The experiment uses a single speaker to measure the  different angles of incidence, thus either the speaker has to be moved around the center of the HATS, or the HATS will have to be rotates on its axis to the right angles. \\
It was chosen to adjust the angle by rotating the HATS around the center of its own axis, leaving the speaker in place. This creates a triangle between the speaker, microphone and inner microphone of the HATS. The resolution of the scale on the HATS is 2\degrees. The baseline of the triangle is from the microphone to the inner microphone, and angle is adjusted according to that line.
Measurements are made for the following angles:
\begin{table}[H]
	\centering
	\begin{tabular}{c c c c c c c c c c} \toprule
		0\degrees & 10\degrees & 20\degrees & 30\degrees & 40\degrees & 50\degrees & 60\degrees & 70\degrees & 80\degrees & 90\degrees \\ \bottomrule
	\end{tabular}
\caption{Angles that measurements should be performed at. 0\degrees  is the situation in \autoref{fig:AngOfIndOnax}.}
\label{Tab:AngleOfInciMeasAngles}
\end{table}
 
\subsubsection{Control and calibration}
The speaker is placed 1.6 meters from the center of the HATS. \\\\
The two microphones SpeakerMic and Ref are fixed at distances 8.85 cm and 12.45 cm from the center of the HATS respectively. The SpeakerMic is fitted just in front of the headphone speaker using medical tape.\\\\
For each microphone and pre-amplifier calibrations are made on the computer using Simulink\textsuperscript{\textregistered}.
\begin{itemize}
	\item For the Ref microphone, calibration is made at 1 $k$Hz using the B\&K 4230 as calibrator. This should yield a signal of 93.6 dB as it is a pressure field microphone. The measured intensity in MATLAB\textsuperscript{\textregistered} was 68.99 dB so all measurements are multiplied by 17.00 to get a calibrated signal in MATLAB\textsuperscript{\textregistered}. 
	\item For the Error microphone, calibration is made at 1 $k$Hz using the B\&K 4230 as calibrator with adapter B\&K 0741 for the ear of the HATS. This should yield a signal of 95.6 dB, according to the datasheet of the HATS. The measured intensity in MATLAB\textsuperscript{\textregistered} was 78.22 dB so all measurements are multiplied by 7.40 to get a calibrated signal in MATLAB\textsuperscript{\textregistered}. 
	\item For the speakerMic, calibration is made using a earplug cut in half and fitted around the microphone, as an adapter. This simple adapter allows the B\&K 4230 to be used as calibrator. The measured output level is 84.37 dB, and should have been 94.0 dB . Therefore all measurements are multiplied by 3.03 to get a calibrated signal in MATLAB\textsuperscript{\textregistered}
\end{itemize} 
 
\subsubsection{Equipment settings}
\begin{itemize}
	\item This experiment is performed with a sampling rate of, f$_{s}$ = 48 $k$Hz.
	\item The Ref microphone is placed just outside the headset in-line with the ear and speaker unit. 
	\item The SpeakerMic is placed inside the headphone, as close to the speaker unit as possible. 
	\item For on the RME, the "inst"-option is turned on in the mixing console. The following gain settings are present: 		
	\begin{itemize}
		\item Line level gain is 0 dB
		\item Error Microphones has gain +30 dB
		\item Ref Microphones has gain +48 dB
		\item Speaker Microphones has gain +48 dB
	\end{itemize}
	\item All settings on the computer is set to 0 dBFS
	\item A logarithmic sine sweep is generated and saved in MATLAB\textsuperscript{\textregistered} using the chirp function as follows:
	\begin{lstlisting} [language=Matlab	]
	fs=48000;
	f1=50;
	f2=fs/2;
	t=0:1/fs:5-1/fs;
	t2=5;
	sweep=chirp(t,f1,t2,f2,'logarithmic',90);
	sweep=[zeros(1,fs) sweep zeros(1,fs)];
	audiowrite('LogChirp.wav', sweep,fs);
	\end{lstlisting}
	Resulting in a 5 seconds long logarithmic sweep from 50 Hz -- 24 $k$Hz starting at zero.
\end{itemize} 
 
% \subsection{Pictures}
% The following Matlab code is used to calculate the angles at which measurements should be performed. The first measurement is performed at a 180\degrees angle. This determines the length of the baseline (maxI in the code below). After determining the angles of interest can be calculated.  \\
%The script is based on two triangles that share a corner, the turning point, and a side to the speaker. The two triangles share the same angle at the turning point. This creates for two equations with two unknowns using the cosine relation and the fact that the side opposite the turning point should have a length "x" in one triangle and "x" + an amount of samples in the other triangle. Using this the angle can  be found.

%\begin{figure}[H]
%%	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/TriangleCalculation.pdf}
%\tikzsetnextfilename{AngleOfIcidenceTriangleCalculation}
%\begin{tikzpicture}
%\draw (4,0) node (v3) {} -- (-1,0);
%\draw (-1,0) -- (-3,0);
%\draw (-3,0) -- (-3,-0.6);
%\draw (-1,0) node (v1) {} -- (-1,-0.6);
%\draw (-5,5) node (v2) {} -- (-1,0) -- (-5,5) node (v4) {} -- (-3,0);
%\draw (4,0) -- (-5,5);
%\node at (-5.1,5.7) {Speaker};
%\node at (-3,-0.9) {SpeakerMic};
%\node at (-1,-0.9) {Ref};
%\node at (5.3,-0.1) {Turning Point};
%\node at (2.8,0.2) {Angle};
%\node at (0.7,2.5) {$Dist_{Speaker}$};
%\node at (-1.9,2) {$x+i$};
%\node at (-4.2,2) {$x$};
%\end{tikzpicture}
%\label{Fig:AngleOfIcidenceTriangleCalculation}
%\caption{The two triangles spanned by the center of the HATS, the speaker and two of the microphones.}
%\end{figure}  

\subsection{Procedure}
\subsubsection{Set-up}
A schematically overview of the experiment is shown in figure \ref{Fig:AngleOfIncidenceSetup}. The experiment is controlled via the RME Fireface 802, which acts as both the recording device and signal generator. A picture of the setup is shown in figure \ref{AngIncidenceSetup}. The reference microphone is fixed to the outside of the headphone cup using thick metal wire and a glue gun.  

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceSetup.pdf}
	\caption{Setup of experiment on angle of incidence.}
	\label{Fig:AngleOfIncidenceSetup}
\end{figure}

\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngInSetup.jpg}
	\caption{Setup of the experiment.}
	\label{AngIncidenceSetup}	
\end{figure}


\subsection{Performing the experiment}
\begin{enumerate}
	\item Set the HATS to the desired test angle. 
	\item Open Simulink\textsuperscript{\textregistered} and run file \path{SimulinkAngleOfIndence.xls}.
	\item This will play \path{LogChirp.wav} through the speaker.
	\item Record and save, and name \path{Mic[i].wav}, \path{SpM[i].wav}, \path{loop[i].wav} and \path{Ref[i].wav}\footnote{[i] indicates the angle of the experiment}.
	\item Repeat the experiment for all angles.
\end{enumerate}



\subsection{Data extraction}

All data is automatically stored when the script \path{SimulinkAngleOfIndence.xls} is run.



\subsection{Analysis}
The cross correlation method described in \autoref{Sec:MeasATransFunc} is used to find the transfer functions. The Reference microphone is used as input signal and the speakerMic is used as output. The system under test is the cup of the headphone. 
Below the frequency response and time response of the system is plotted. 
\begin{figure}[H]
	\tikzsetnextfilename{AngOfIncFreq}
	\input{../Journal/Experiments/AngleOfIncidence/AngOfIncFreq.tex}
	\caption{Transfer Function from Ref to Speaker - Frequency domain}

	\label{Fig:AngOfIncFreq}
\end{figure}
It can be seen, that the frequency response varies above 500 Hz with angle of incidence. This means that ideally the headphone transfer function should vary with the angle of incidence in a real time implementation.  

%\begin{figure}[H]
%	\tikzsetnextfilename{AngOfIncTime}
%	\input{../Journal/Experiments/AngleOfIncidence/AngOfIncTime.tex}
%	\label{Fig:AngOfIncTime}
%	\caption{Transfer Function from Ref to Speaker - Time domain 256 coefficients}
%\end{figure}
\autoref{Fig:AngOfIncTime} shows the first 960 filter coefficients of a FIR filter with the same frequency response as the cup of the headphone. We are interested in the delay between the impulses, therefore a plot with a zoom is shown in \autoref{Fig:AngOfIncTimezoom}.
%\begin{figure}[H]
%	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/impulsezoomRef2Speaker.png}
%	\label{Fig:AngOfIncTimezoom}
%	\caption{The time response from different angles (zoomed).}
%\end{figure} 
As expected the impulses are approximately delayed versions of each other. The on axis (0\degrees) yields the longest delay between the Ref microphone and SpeakerMic. The 90\degrees case yields no delay at all. 


\begin{figure}[H]
	\centering
	\begin{subfigure}[b]{\textwidth}
	\tikzsetnextfilename{AngOfIncTime}
	\input{../Journal/Experiments/AngleOfIncidence/AngOfIncTime.tex}
	\caption{Transfer Function from Reference microphone to Speaker - showing 960 samples, it is clearly seen the lack of attenuation at low frequencies.}
	\label{Fig:AngOfIncTime}
	\end{subfigure} 
	\begin{subfigure}[b]{\textwidth}
	\tikzsetnextfilename{AngOfIncTimeZoom}
	\input{../Journal/Experiments/AngleOfIncidence/AngOfIncTimeZoom.tex}
	\label{Fig:AngOfIncTimezoom}
	\caption{Zoomed graph of figure \ref{Fig:AngOfIncTime}, showing the first 30 Samples. With each incrementation it is seen that the delay decreases.}
	\end{subfigure}
	\caption{The Transfer function showed at different angles with a incrementation of $10^{\circ}$}
	\label{fig:AngOfIncResult}
\end{figure}

\subsection{Accuracy}

It should be noted that the anechoic room housed both preamplifiers, tripods and stands. Furthermore the speaker microphone may have resulted in a small air gab when placed on the HATS. It appears not to have changes during the measurements based on consistency in the results, but it can have caused small deviation.

\subsection{Conclusion}
If only one microphone is placed on the outside of the cup, some calculation time is lost. The largest calculation time is achieved when sound propagates from the side of the wearer. If sound comes from the front there is no calculation time at all. 