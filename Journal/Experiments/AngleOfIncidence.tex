
\section{The aengle of Incidences influence on the headphone transfer function} \label{sec:AngleOfIncidence}

\subsection{Purpose}
The purpose of this experiment is to determine if the angle of incidence has any influence on the headphone transfer function. 

The hypothesis is that the angle on incidence influences both the time delay and magnitude response of the transfer functions.

Measurements will only be performed in a horizontal plane. 

\subsection{AAU num list}
\begin{table}[H]
	\centering
	\ra{1.3}
	\begin{tabular}{ c c c } \toprule
		{Item}	& {Description} 						& {AAU-no}. \\ \bottomrule 
		1	&	B\&K Head And Torso Simulator "Henry" Type 4128	& 08453	\\
		2	&	B\&K Â½'' Condenser Microphone Type 4134 	& 08130		\\
		3	&	Beyerdynamic DT 770 Headphones				& 2037-18		\\
		4	&	Soundcard RME Fireface 802					& 86838		\\
		5	&	Computer running simulink		& NaN		\\
		6	&	GRAS pre-amplifier type 26-AK			& 52665		\\
		7	&	B\&K Sound Calibrator Type 4230				& 08155		\\ 
		8	&	Knowles FG-23329 microphone					& NaN		\\
		9	&	Genelec speaker								& 33990		\\ 
		10	&	Preamp for FG-23329  microphone	& NaN\\
		11	& 	B\&K Microphone Power Supply Type 2804		& 07304		\\
		\bottomrule
	\end{tabular}
	\caption{Table over equipment used in test.}
	\label{tab:AngleOfIncideceHP}
\end{table}

\subsection{Diagram}
\begin{figure}[H]
	\centering
	\begin{subfigure}[b]{.4\textwidth}
		\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceOnAxis.pdf}
		\caption{On axis}
		\label{fig:AngOfIndOnax}
		\vspace{2ex}
		\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceOffAxis.pdf}
		\caption{Off axis}
		\label{fig:AngOfIndOffax}
	\end{subfigure} 
	\begin{subfigure}[b]{.4\textwidth}
	\centering
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceSchematic.pdf}
	\caption{Placement of microphones.}
	\label{fig:AngOgIndMicplace}
\end{subfigure}
	\caption{Placement of microphones and rotation}
	\label{fig:AngleOfIndDiagram}
\end{figure}


\subsection{Settings/Description}
The experiment uses a single speaker to measure angles of incidence. Therefore either the speaker has to be moved around or the HATS will have to be turned to the right angles. \\
Adjusting the angle is done by rotating the HATS around the centre of the HATS leaving the speaker in place. This creates a triangle between the speaker, microphone and inner microphone of the HATS. The resolution of the scale on the HATS is 2\degrees. The baseline of the triangle is from the microphone to the inner microphone, and angle is adjusted according to that line.
The following angles are examined:
\begin{table}[H]
	\centering
	\begin{tabular}{c c c c c c c c c c} \toprule
		0\degrees & 10\degrees & 20\degrees & 30\degrees & 40\degrees & 50\degrees & 60\degrees & 70\degrees & 80\degrees & 90\degrees \\ \bottomrule
	\end{tabular}
\label{Tab:AngleOfInciMeasAngles}
\caption{Angles that measurements should be performed at. 0\degrees  is the situation in \autoref{fig:AngOfIndOnax}.}
\end{table}
 
% The following Matlab code is used to calculate the angles at which measurements should be performed. The first measurement is performed at a 180\degrees angle. This determines the length of the baseline (maxI in the code below). After determining the angles of interest can be calculated.  \\
%The script is based on two triangles that share a corner, the turning point, and a side to the speaker. The two triangles share the same angle at the turning point. This creates for two equations with two unknowns using the cosine relation and the fact that the side opposite the turning point should have a length "x" in one triangle and "x" + an amount of samples in the other triangle. Using this the angle can  be found.

\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/TriangleCalculation.pdf}
	\label{Fig:AngleOfIcidenceTriangleCalculation}
	\caption{The two triangles spanned by the center of the HATS, the speaker and two of the microphones. M1 is the speakerMic and M2 is the Ref}
\end{figure}  


\subsection{Set-up}
\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngleOfIncidenceSetup.pdf}
	\caption{Setup of experiment on angle of incidence.}
	\label{Fig:AngleOfIncidenceSetup}
\end{figure}

\subsection{Choice of equipment}
The experiment aims to be valid in the frequency range 50Hz to 20 $k$Hz. This means that all equipment used should cover that frequency range. \\\\
The experiment uses a total of three microphones. The error microphone located inside the HATS's ear is given by the type fitted to the dummy. The SpeakerMic should be as small as possible in order to avoid influencing the transfer functions that are being measured. For this the very small Knowles FG-23329 is used. The Ref microphone has less restrictions on size and placement. This allows for the choice of a good standard measurement microphone, B\&K 4134. \\\\
For the speaker the limiting criteria is the lower roll off, especially in an anechoic chamber were reflections does not offer any amplification of lower frequencies. However transfer functions between the microphones are measured, so absolute flatness is not critical. The Genelec 1031-A is chosen. \\\\
The measurement system uses a RME Fireface 802 controlled using Simulink\textsuperscript{\textregistered}. Data extraction is made using the method described in \autoref{Sec:MeasATransFunc}.

\subsection{Control and calibration}
The speaker is placed 1.6 meters from the center of the HATS. \\\\
The two microphones SpeakerMic and Ref are fixed at distances 8.85 cm and 12.45 cm from the center of the HATS respectively. The SpeakerMic is fitted just in front of the headphone speaker using medical tape.\\\\
For each microphone and pre-amplifier calibrations are made on the computer using Simulink\textsuperscript{\textregistered}.
\begin{itemize}
	\item For the Ref microphone, calibration is made at 1 $k$Hz using the B\&K 4230 as calibrator. This should yield a signal of 93.6 dB as it is a pressure field microphone. The measured intensity in MATLAB\textsuperscript{\textregistered} was 68.99 so all measurements are multiplied by 17.00 to get a calibrated signal in MATLAB\textsuperscript{\textregistered}. 
	\item For the Error microphone, calibration is made at 1 $k$Hz using the B\&K 4230 as calibrator with adapter B\&K 0741 for the ear of the HATS. This should yield a signal of 95.6 dB. The measured intensity in MATLAB\textsuperscript{\textregistered} was 78.22 so all measurements are multiplied by 7.40 to get a calibrated signal in Matlab. 
	\item For the speakerMic, calibration is made using a earplug cut in half and fitted around the microphone, as an adapter. This simple adapter allows the B\&K 4230 to be used as calibrator. The measured output level is 84.37, and should have been 94.0 dB . Therefore all measurements are multiplied by 3.03 to get a calibrated signal in MATLAB\textsuperscript{\textregistered}
\end{itemize}
 
\subsection{Equipment settings}
\begin{itemize}
	\item This experiment is performed with a sampling rate of, $F_{s}$ = 48 $k$Hz.
	\item The Ref microphone is placed just outside the headset in-line with the ear and speaker unit. 
	\item The SpeakerMic is placed inside the headphone, as close to the speaker unit as possible. 
	\item For the sound card take care to turn on the "inst"-option in the mixing console. The following gain settings are present: 		
	\begin{itemize}
		\item Line level gain is 0 dB
		\item Error Microphones has gain +30 dB
		\item Ref Microphones has gain +48 dB
		\item Speaker Microphones has gain +48 dB
	\end{itemize}
	\item All settings on the computer is set to 0 dBFS
	\item A logarithmic sine sweep is generated and saved in MATLAB\textsuperscript{\textregistered} using the chirp function as follows:
	\begin{lstlisting} [language=Matlab	]
	fs=48000;
	f1=50;
	f2=fs/2;
	t=0:1/fs:5-1/fs;
	t2=5;
	sweep=chirp(t,f1,t2,f2,'logarithmic',90);
	sweep=[zeros(1,fs) sweep zeros(1,fs)];
	audiowrite('LogChirp.wav', sweep,fs);
	\end{lstlisting}
\end{itemize}

\subsection{Picture}
\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/AngInSetup.jpg}
	\label{AngIncidenceSetup}	
	\caption{Setup of the experiment.}
\end{figure}


\subsection{Procedure}
\begin{enumerate}
	\item Set the HATS to the desired test angle. 
	\item Open Simulink\textsuperscript{\textregistered} and run file "SimulinkAngleOfIndence.xls".
	\item Run Simulink\textsuperscript{\textregistered} to play "LogChirp.wav" through the speaker.
	\item Record and save, and name "Mic[i].wav", "SpM[i].wav", "loop[i].wav" and Ref[i].wav"\footnote{[i] indicates the angle of the experiment}.
	\item Repeat the experiment for all angles.
\end{enumerate}

\subsection{Data Extraction}
The data is saved during the experiment.

\subsection{Analysis}
The cross correlation method described in \autoref{Sec:MeasATransFunc} is used to find the transfer functions. The Reference microphone is used as input signal and the speakerMic is used as output. The system under test is the cup of the headphone. 
Below the frequency response and time response of the system is plotted. 
\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/TransRef2Speaker.png}
	\label{Fig:AngOfIncFreq}
	\caption{The frequency response from different angles.}
\end{figure}
It can be seen, that apart from some resonances the frequency response does not change drastically. Especially in the lower frequency regions, where the ANC system will work. 

\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/impulseRef2Speaker.png}
	\label{Fig:AngOfIncTime}
	\caption{The time response from different angles.}
\end{figure}
The figure shows the first 256 filter coefficients of a FIR filter with the same frequency response as the cup of the headphone. We are interested in the delay between the impulses, therefore a plot with a zoom is shown below.
\begin{figure}[H]
	\includegraphics[width=\textwidth]{../Journal/Experiments/AngleOfIncidence/impulsezoomRef2Speaker.png}
	\label{Fig:AngOfIncTimezoom}
	\caption{The time response from different angles (zoomed).}
\end{figure} 
As expected the impulses are approximately delayed versions of each other. The on axis (0\degrees) yields the longest delay between the Ref microphone and SpeakerMic. The 90\degrees  case yields no delay at all. 

\subsection{Error Sources}

\subsection{Conclusion}
If only one microphone is placed on the outside of the cup, some calculation time is lost. The largest calculation time is achieved when sound propagates from the side of the wearer. If sound comes from the front no calculation time is left. 